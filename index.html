<!DOCTYPE html>
<html lang="en" class="dark:bg-darkBg antialiased">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>High-CPM Multi-Tab Browser</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        darkBg: '#111827',
                        darkText: '#f3f4f6',
                        darkCard: '#1f2937',
                        darkBorder: '#374151'
                    }
                }
            }
        };
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .window-container {
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }
        
        .dark .window-container {
            border-color: #374151;
        }
        
        .tab-header {
            display: flex;
            background: #f3f4f6;
            border-bottom: 1px solid #e5e7eb;
            overflow-x: auto;
            scrollbar-width: none;
        }
        
        .dark .tab-header {
            background: #374151;
            border-bottom-color: #4b5563;
        }
        
        .tab-header::-webkit-scrollbar {
            display: none;
        }
        
        .tab {
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-size: 0.875rem;
            white-space: nowrap;
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border-right: 1px solid #e5e7eb;
        }
        
        .dark .tab {
            border-right-color: #4b5563;
            color: #f3f4f6;
        }
        
        .tab.active {
            @apply bg-white dark: bg-darkCard font-medium;
            border-bottom: 3px solid #3b82f6;
            margin-bottom: -1px;
        }
        
        .tab .close-btn {
            width: 16px;
            height: 16px;
            line-height: 16px;
            text-align: center;
            border-radius: 50%;
            font-size: 10px;
            opacity: 0.6;
            transition: opacity 0.2s;
        }
        
        .tab:hover .close-btn {
            opacity: 1;
        }
        
        .tab .close-btn:hover {
            background: #ef4444;
            color: white;
        }
        
        .iframe-container {
            position: relative;
            height: 350px;
            background: #fff;
        }
        
        .dark .iframe-container {
            background: #1f2937;
        }
        
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            border-radius: 0.5rem;
        }
        
        .dashboard-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            z-index: 9999;
            display: none;
            flex-wrap: wrap;
            overflow: auto;
            padding: 10px;
            gap: 8px;
        }
        
        .dashboard-frame {
            flex: 1 1 calc(33.33% - 10px);
            min-height: 200px;
            border: 1px solid #333;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .dashboard-frame iframe {
            width: 100%;
            height: 100%;
            border: 0;
        }
    </style>
</head>

<body class="bg-gray-100 text-gray-800 dark:bg-darkBg dark:text-darkText transition-colors duration-300">
    <!-- Dashboard Mode (Full Screen) -->
    <div id="dashboard-mode" class="dashboard-mode"></div>

    <div id="normal-mode" class="container max-w-7xl mx-auto p-4 sm:p-6">
        <header class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
            <h1 class="text-2xl sm:text-3xl font-bold text-primary flex items-center gap-2">
                ðŸš€ High-CPM Multi-Tab Browser
            </h1>
            <button id="dark-mode-toggle" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white rounded-lg shadow hover:bg-gray-300 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-primary transition">
        Toggle Dark Mode
      </button>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <div class="lg:col-span-3 space-y-6">
                <form id="search-form" class="flex flex-wrap gap-3 items-center">
                    <div class="flex-1 min-w-48">
                        <input type="text" id="search-input" placeholder="Enter URL or search query" class="w-full p-3 border border-gray-300 dark:border-darkBorder rounded-lg shadow-sm focus:ring-2 focus:ring-primary focus:border-primary outline-none bg-white dark:bg-darkCard text-gray-800 dark:text-darkText transition"
                        />
                    </div>
                    <div>
                        <input type="number" id="window-count-input" value="3" min="1" class="w-20 p-3 border border-gray-300 dark:border-darkBorder rounded-lg shadow-sm focus:ring-2 focus:ring-primary focus:border-primary outline-none bg-white dark:bg-darkCard text-gray-800 dark:text-darkText transition"
                            title="Number of windows to open" />
                    </div>
                    <button id="open-windows-button" class="px-6 py-3 bg-primary text-white rounded-lg shadow hover:bg-blue-700 disabled:opacity-60 disabled:cursor-not-allowed font-medium transition w-full sm:w-auto" type="button">
            Open Windows
          </button>
                </form>

                <div id="message-box" class="hidden p-4 text-center font-medium rounded-lg border border-transparent transition-all duration-300"></div>

                <div id="window-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 auto-rows-fr"></div>
            </div>

            <div class="lg:col-span-1 bg-white dark:bg-darkCard p-4 rounded-lg shadow space-y-4">
                <h2 class="font-bold text-lg">CPM Mode</h2>
                <div class="space-y-3">
                    <label class="block">
            <span class="text-sm">Auto Refresh (sec)</span>
            <input type="number" id="refresh-interval" value="60" min="30" class="w-full p-2 border rounded dark:bg-darkCard" />
          </label>
                    <label class="block">
            <input type="checkbox" id="enable-refresh" class="mr-2" />
            <span class="text-sm">Enable Auto-Refresh</span>
          </label>
                    <button id="enter-dashboard-mode" class="w-full py-2 bg-green-600 hover:bg-green-700 text-white rounded transition">
            Enter Dashboard Mode
          </button>
                    <button id="exit-dashboard-mode" class="w-full py-2 bg-red-600 hover:bg-red-700 text-white rounded transition hidden">
            Exit Dashboard
          </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const searchInput = document.getElementById('search-input');
        const windowCountInput = document.getElementById('window-count-input');
        const openWindowsButton = document.getElementById('open-windows-button');
        const windowGrid = document.getElementById('window-grid');
        const messageBox = document.getElementById('message-box');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const refreshIntervalInput = document.getElementById('refresh-interval');
        const enableRefresh = document.getElementById('enable-refresh');
        const enterDashboardBtn = document.getElementById('enter-dashboard-mode');
        const exitDashboardBtn = document.getElementById('exit-dashboard-mode');
        const dashboardMode = document.getElementById('dashboard-mode');
        const normalMode = document.getElementById('normal-mode');

        // State
        let nextWindowId = 1;
        let nextTabId = 1;
        let refreshInterval = null;

        // Load saved state
        window.addEventListener('load', () => {
            searchInput.value = localStorage.getItem('lastSearch') || '';
            windowCountInput.value = localStorage.getItem('lastCount') || '3';
            refreshIntervalInput.value = localStorage.getItem('refreshInterval') || '60';
            if (localStorage.getItem('theme') === 'dark') {
                document.documentElement.classList.add('dark');
            }
            validateInput();
        });

        // Save state
        searchInput.addEventListener('input', () => {
            localStorage.setItem('lastSearch', searchInput.value);
            validateInput();
        });
        windowCountInput.addEventListener('input', () => {
            localStorage.setItem('lastCount', windowCountInput.value);
            validateInput();
        });
        refreshIntervalInput.addEventListener('input', () => {
            localStorage.setItem('refreshInterval', refreshIntervalInput.value);
        });

        function validateInput() {
            const value = searchInput.value.trim();
            const count = parseInt(windowCountInput.value);
            openWindowsButton.disabled = !(value && count > 0);
        }

        function sanitizeUrl(url) {
            try {
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    url = 'https://' + url;
                }
                return new URL(url).href;
            } catch (e) {
                return null;
            }
        }

        function showMessage(message, type = 'success') {
            messageBox.textContent = message;
            messageBox.className = `p-4 text-center font-medium rounded-lg transition ${
        type === 'success'
          ? 'bg-green-100 text-green-700 border border-green-400 dark:bg-green-200 dark:text-green-900'
          : 'bg-red-100 text-red-700 border border-red-400 dark:bg-red-200 dark:text-red-900'
      }`;
            messageBox.classList.remove('hidden');
            setTimeout(() => {
                messageBox.classList.add('opacity-0');
                setTimeout(() => messageBox.classList.add('hidden'), 300);
            }, 3000);
        }

        function createTab(windowId, url, title = 'New Tab', isActive = false) {
            const tabId = `tab-${nextTabId++}`;
            const tab = document.createElement('div');
            tab.className = `tab ${isActive ? 'active' : ''}`;
            tab.dataset.tabId = tabId;
            tab.dataset.url = url;
            tab.innerHTML = `<span class="truncate max-w-[120px]">${title}</span><span class="close-btn">Ã—</span>`;

            tab.addEventListener('click', (e) => {
                if (e.target.classList.contains('close-btn')) {
                    e.stopPropagation();
                    closeTab(tab, windowId);
                    return;
                }
                activateTab(tab, windowId);
            });

            return {
                tab,
                tabId
            };
        }

        function activateTab(tabElement, windowId) {
            const container = document.getElementById(`window-${windowId}`);
            container.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            container.querySelectorAll('iframe').forEach(f => f.classList.add('hidden'));

            tabElement.classList.add('active');
            const iframe = document.getElementById(`iframe-${windowId}-${tabElement.dataset.tabId}`);
            if (iframe) iframe.classList.remove('hidden');
        }

        function closeTab(tabElement, windowId) {
            const container = document.getElementById(`window-${windowId}`);
            const iframe = document.getElementById(`iframe-${windowId}-${tabElement.dataset.tabId}`);

            tabElement.remove();
            iframe.remove();

            if (container && !container.querySelector('.tab')) {
                container.remove();
                showMessage('Window closed.');
            }
        }

        function createIframe(windowId, tabId, url) {
            const iframe = document.createElement('iframe');
            iframe.id = `iframe-${windowId}-${tabId}`;
            iframe.src = url;
            iframe.sandbox = "allow-same-origin allow-scripts allow-popups allow-forms"
            iframe.allow = "accelerometer; camera; fullscreen; geolocation; microphone; clipboard-read; clipboard-write"
            iframe.loading = "lazy"
            iframe.className = 'w-full h-full border-0 hidden';

            const loader = document.createElement('div');
            loader.className = 'loading-overlay';
            loader.innerHTML = `<div class="text-center"><div class="inline-block h-6 w-6 animate-spin rounded-full border-4 border-solid border-current"></div><p class="mt-2">Loading...</p></div>`;

            const container = document.createElement('div');
            container.className = 'iframe-container relative';
            container.appendChild(iframe);
            container.appendChild(loader);

            iframe.onload = () => loader.remove();
            iframe.onerror = () => loader.innerHTML = '<p class="text-red-400">Failed to load</p>';

            return container;
        }

        function openMultipleWindows() {
            const rawInput = searchInput.value.trim();
            const numWindows = parseInt(windowCountInput.value);
            const url = sanitizeUrl(rawInput) || `https://www.google.com/search?q=${encodeURIComponent(rawInput)}`;

            if (!url) {
                showMessage('Invalid URL.', 'error');
                return;
            }

            for (let i = 0; i < numWindows; i++) {
                const windowId = nextWindowId++;
                const win = document.createElement('div');
                win.id = `window-${windowId}`;
                win.className = 'window-container bg-white dark:bg-darkCard border border-gray-200 dark:border-darkBorder rounded-lg shadow overflow-hidden';

                const header = document.createElement('div');
                header.className = 'tab-header';

                const {
                    tab,
                    tabId
                } = createTab(windowId, url, extractTitle(rawInput), true);
                header.appendChild(tab);

                const newTabBtn = document.createElement('div');
                newTabBtn.className = 'tab text-primary font-bold cursor-pointer';
                newTabBtn.innerHTML = '+';
                newTabBtn.title = 'New Tab';
                newTabBtn.onclick = () => openNewTab(windowId, rawInput);
                header.appendChild(newTabBtn);

                win.appendChild(header);
                win.appendChild(createIframe(windowId, tabId, url));
                windowGrid.appendChild(win);
            }

            showMessage(`${numWindows} windows opened!`, 'success');
        }

        function openNewTab(windowId, rawInput) {
            const url = sanitizeUrl(rawInput) || `https://www.google.com/search?q=${encodeURIComponent(rawInput)}`;
            const title = extractTitle(rawInput);
            const container = document.getElementById(`window-${windowId}`);
            const header = container.querySelector('.tab-header');
            const newTabBtn = header.lastElementChild;

            const {
                tab,
                tabId
            } = createTab(windowId, url, title, true);
            header.insertBefore(tab, newTabBtn);

            const iframeContainer = createIframe(windowId, tabId, url);
            container.appendChild(iframeContainer);

            tab.click();
        }

        function extractTitle(input) {
            try {
                return new URL(input.startsWith('http') ? input : 'https://' + input).hostname;
            } catch {
                return input.length > 20 ? input.slice(0, 20) + '...' : input;
            }
        }

        // Dashboard Mode
        enterDashboardBtn.addEventListener('click', () => {
            const iframes = Array.from(document.querySelectorAll('#window-grid iframe')).map(iframe => iframe.src);
            if (iframes.length === 0) {
                showMessage('Open some tabs first!', 'error');
                return;
            }

            normalMode.style.display = 'none';
            dashboardMode.style.display = 'flex';

            dashboardMode.innerHTML = '';
            iframes.forEach(src => {
                const frame = document.createElement('div');
                frame.className = 'dashboard-frame';
                frame.innerHTML = `<iframe src="${src}" sandbox="allow-same-origin allow-scripts"></iframe>`;
                dashboardMode.appendChild(frame);
            });

            startAutoRefresh();
            exitDashboardBtn.classList.remove('hidden');
        });

        exitDashboardBtn.addEventListener('click', () => {
            dashboardMode.style.display = 'none';
            normalMode.style.display = 'block';
            stopAutoRefresh();
            exitDashboardBtn.classList.add('hidden');
        });

        function startAutoRefresh() {
            if (enableRefresh.checked) {
                const interval = parseInt(refreshIntervalInput.value) * 1000;
                stopAutoRefresh();
                refreshInterval = setInterval(() => {
                    const iframes = dashboardMode.querySelectorAll('iframe');
                    iframes.forEach(iframe => {
                        iframe.src = iframe.src; // Refresh
                    });
                    console.log("Auto-refreshed all dashboard iframes.");
                }, Math.max(interval, 30000)); // Minimum 30s
            }
        }

        function stopAutoRefresh() {
            if (refreshInterval) clearInterval(refreshInterval);
            refreshInterval = null;
        }

        enableRefresh.addEventListener('change', () => {
            if (enableRefresh.checked && dashboardMode.style.display !== 'none') {
                startAutoRefresh();
            } else {
                stopAutoRefresh();
            }
        });

        openWindowsButton.addEventListener('click', openMultipleWindows);

        darkModeToggle.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            darkModeToggle.textContent = isDark ? 'Light Mode' : 'Dark Mode';
        });
    </script>
</body>

</html>
