<!DOCTYPE html>
<html lang="en" class="dark:bg-darkBg antialiased">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Multi-Tab Window Browser</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#3b82f6',
            darkBg: '#111827',
            darkText: '#f3f4f6',
            darkCard: '#1f2937',
            darkBorder: '#374151'
          }
        }
      }
    };
  </script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      transition: background-color 0.3s, color 0.3s;
    }

    .window-container {
      border-radius: 0.5rem;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border: 1px solid #e5e7eb;
      transition: transform 0.1s;
    }

    .window-container:hover {
      transform: translateY(-2px);
    }

    .dark .window-container {
      border-color: #374151;
    }

    .tab-header {
      display: flex;
      background: #f3f4f6;
      border-bottom: 1px solid #e5e7eb;
      overflow-x: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .dark .tab-header {
      background: #374151;
      border-bottom-color: #4b5563;
    }

    .tab-header::-webkit-scrollbar {
      display: none;
    }

    .tab {
      padding: 0.5rem 1rem;
      cursor: pointer;
      font-size: 0.875rem;
      white-space: nowrap;
      position: relative;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      border-right: 1px solid #e5e7eb;
    }

    .dark .tab {
      border-right-color: #4b5563;
      color: #f3f4f6;
    }

    .tab.active {
      @apply bg-white dark:bg-darkCard font-medium;
      border-bottom: 3px solid #3b82f6;
      margin-bottom: -1px;
    }

    .tab .close-btn {
      width: 16px;
      height: 16px;
      line-height: 16px;
      text-align: center;
      border-radius: 50%;
      font-size: 10px;
      opacity: 0.6;
      transition: opacity 0.2s;
    }

    .tab:hover .close-btn {
      opacity: 1;
    }

    .tab .close-btn:hover {
      background: #ef4444;
      color: white;
    }

    .iframe-container {
      position: relative;
      height: 400px;
      background: #fff;
    }

    .dark .iframe-container {
      background: #1f2937;
    }

    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      border-radius: 0.5rem;
    }
  </style>
</head>

<body class="bg-gray-100 text-gray-800 dark:bg-darkBg dark:text-darkText transition-colors duration-300">
  <div class="container max-w-7xl mx-auto p-4 sm:p-6">
    <header class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
      <h1 class="text-2xl sm:text-3xl font-bold text-primary flex items-center gap-2">
        üåê Multi-Tab Web Browser
      </h1>
      <button id="dark-mode-toggle"
        class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white rounded-lg shadow hover:bg-gray-300 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-primary transition">
        Toggle Dark Mode
      </button>
    </header>

    <form id="search-form" class="flex flex-wrap gap-3 items-center mb-6">
      <div class="flex-1 min-w-48">
        <label for="search-input" class="sr-only">Search or URL</label>
        <input type="text" id="search-input" placeholder="Enter URL or search query"
          class="w-full p-3 border border-gray-300 dark:border-darkBorder rounded-lg shadow-sm focus:ring-2 focus:ring-primary focus:border-primary outline-none bg-white dark:bg-darkCard text-gray-800 dark:text-darkText transition" />
      </div>
      <div>
        <label for="window-count-input" class="sr-only"># of Windows</label>
        <input type="number" id="window-count-input" value="3" min="1"
          class="w-20 p-3 border border-gray-300 dark:border-darkBorder rounded-lg shadow-sm focus:ring-2 focus:ring-primary focus:border-primary outline-none bg-white dark:bg-darkCard text-gray-800 dark:text-darkText transition"
          title="Number of windows to open" />
      </div>
      <button id="open-windows-button"
        class="px-6 py-3 bg-primary text-white rounded-lg shadow hover:bg-blue-700 disabled:opacity-60 disabled:cursor-not-allowed font-medium transition w-full sm:w-auto"
        type="button">
        Open Windows
      </button>
    </form>

    <div id="message-box"
      class="hidden p-4 mb-6 text-center font-medium rounded-lg border border-transparent transition-all duration-300"></div>

    <div id="window-grid"
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 auto-rows-fr"></div>
  </div>

  <script>
    // DOM Elements
    const searchInput = document.getElementById('search-input');
    const windowCountInput = document.getElementById('window-count-input');
    const openWindowsButton = document.getElementById('open-windows-button');
    const windowGrid = document.getElementById('window-grid');
    const messageBox = document.getElementById('message-box');
    const darkModeToggle = document.getElementById('dark-mode-toggle');

    // State
    let nextWindowId = 1;
    let nextTabId = 1;

    // Load saved state
    window.addEventListener('load', () => {
      searchInput.value = localStorage.getItem('lastSearch') || '';
      windowCountInput.value = localStorage.getItem('lastCount') || '3';
      if (localStorage.getItem('theme') === 'dark') {
        document.documentElement.classList.add('dark');
      }
      validateInput();
    });

    // Save state on change
    searchInput.addEventListener('input', () => {
      localStorage.setItem('lastSearch', searchInput.value);
      validateInput();
    });
    windowCountInput.addEventListener('input', () => {
      localStorage.setItem('lastCount', windowCountInput.value);
      validateInput();
    });

    function validateInput() {
      const value = searchInput.value.trim();
      const count = parseInt(windowCountInput.value);
      openWindowsButton.disabled = !(value && count > 0);
    }

    function sanitizeUrl(url) {
      try {
        if (!url.startsWith('http://') && !url.startsWith('https://')) {
          url = 'https://' + url;
        }
        return new URL(url).href;
      } catch (e) {
        return null;
      }
    }

    function showMessage(message, type = 'success') {
      messageBox.textContent = message;
      messageBox.className = `p-4 mb-6 text-center font-medium rounded-lg transition ${
        type === 'success'
          ? 'bg-green-100 text-green-700 border border-green-400 dark:bg-green-200 dark:text-green-900'
          : 'bg-red-100 text-red-700 border border-red-400 dark:bg-red-200 dark:text-red-900'
      }`;
      messageBox.classList.remove('hidden');
      setTimeout(() => {
        messageBox.classList.add('opacity-0');
        setTimeout(() => messageBox.classList.add('hidden'), 300);
      }, 3000);
    }

    function createTab(windowId, url, title = 'New Tab', isActive = false) {
      const tabId = `tab-${nextTabId++}`;
      const tab = document.createElement('div');
      tab.className = `tab ${isActive ? 'active' : ''}`;
      tab.dataset.tabId = tabId;
      tab.dataset.url = url;
      tab.innerHTML = `
        <span class="truncate max-w-[120px]">${title}</span>
        <span class="close-btn">√ó</span>
      `;

      tab.addEventListener('click', (e) => {
        if (e.target.classList.contains('close-btn')) {
          e.stopPropagation();
          closeTab(tab, windowId);
          return;
        }
        activateTab(tab, windowId);
      });

      return { tab, tabId };
    }

    function activateTab(tabElement, windowId) {
      const container = document.getElementById(`window-${windowId}`);
      const tabs = container.querySelectorAll('.tab');
      const iframes = container.querySelectorAll('iframe');

      tabs.forEach(t => t.classList.remove('active'));
      iframes.forEach(f => f.classList.add('hidden'));

      tabElement.classList.add('active');
      const url = tabElement.dataset.url;
      const iframe = document.getElementById(`iframe-${windowId}-${tabElement.dataset.tabId}`);
      if (iframe) iframe.classList.remove('hidden');
    }

    function closeTab(tabElement, windowId) {
      const container = document.getElementById(`window-${windowId}`);
      const iframe = document.getElementById(`iframe-${windowId}-${tabElement.dataset.tabId}`);
      const isActive = tabElement.classList.contains('active');

      tabElement.remove();
      iframe?.remove();

      if (isActive && container.querySelector('.tab')) {
        const firstTab = container.querySelector('.tab');
        firstTab.classList.add('active');
        const firstIframe = document.getElementById(`iframe-${windowId}-${firstTab.dataset.tabId}`);
        firstIframe?.classList.remove('hidden');
      } else if (!container.querySelector('.tab')) {
        container.remove();
        showMessage('All tabs closed. Window removed.');
      }
    }

    function createIframe(windowId, tabId, url) {
      const iframe = document.createElement('iframe');
      iframe.id = `iframe-${windowId}-${tabId}`;
      iframe.src = url;
      iframe.sandbox="allow-same-origin allow-scripts allow-popups allow-forms"
      iframe.allow="accelerometer; camera; fullscreen; geolocation; microphone; clipboard-read; clipboard-write"
      iframe.loading="lazy"
      iframe.className = 'w-full h-full border-0';
      iframe.style.display = 'none';

      const loader = document.createElement('div');
      loader.className = 'loading-overlay';
      loader.innerHTML = `
        <div class="text-center">
          <div class="inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent"></div>
          <p class="mt-2">Loading...</p>
        </div>
      `;

      const container = document.createElement('div');
      container.className = 'iframe-container relative';
      container.appendChild(iframe);
      container.appendChild(loader);

      iframe.onload = () => {
        loader.remove();
        iframe.classList.remove('hidden');
      };

      iframe.onerror = () => {
        loader.querySelector('.loading-overlay').innerHTML = '<p class="text-red-400">Failed to load page.</p>';
      };

      return container;
    }

    function openMultipleWindows() {
      const rawInput = searchInput.value.trim();
      const numWindows = parseInt(windowCountInput.value);
      const url = sanitizeUrl(rawInput) || `https://www.google.com/search?q=${encodeURIComponent(rawInput)}`;

      if (!url) {
        showMessage('Invalid URL entered.', 'error');
        return;
      }

      for (let i = 0; i < numWindows; i++) {
        const windowId = nextWindowId++;
        const windowContainer = document.createElement('div');
        windowContainer.id = `window-${windowId}`;
        windowContainer.className = 'window-container bg-white dark:bg-darkCard border border-gray-200 dark:border-darkBorder rounded-lg shadow overflow-hidden';

        const tabHeader = document.createElement('div');
        tabHeader.className = 'tab-header';

        const { tab, tabId } = createTab(windowId, url, extractTitle(rawInput), true);

        tabHeader.appendChild(tab);
        windowContainer.appendChild(tabHeader);

        const iframeContainer = createIframe(windowId, tabId, url);
        windowContainer.appendChild(iframeContainer);

        windowGrid.appendChild(windowContainer);

        // Add new tab button
        const newTabButton = document.createElement('div');
        newTabButton.className = 'tab text-primary font-bold cursor-pointer';
        newTabButton.innerHTML = '+';
        newTabButton.title = 'New Tab';
        newTabButton.onclick = () => openNewTab(windowId, rawInput);
        tabHeader.appendChild(newTabButton);
      }

      showMessage(`${numWindows} window(s) opened with tabs!`, 'success');
    }

    function openNewTab(windowId, rawInput) {
      const url = sanitizeUrl(rawInput) || `https://www.google.com/search?q=${encodeURIComponent(rawInput)}`;
      const title = extractTitle(rawInput);

      const container = document.getElementById(`window-${windowId}`);
      const tabHeader = container.querySelector('.tab-header');
      const newTabButton = tabHeader.lastElementChild;

      const { tab, tabId } = createTab(windowId, url, title, true);

      // Insert before the "+" button
      tabHeader.insertBefore(tab, newTabButton);

      // Remove active from others
      tabHeader.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      container.querySelectorAll('iframe').forEach(f => f.classList.add('hidden'));

      const iframeContainer = createIframe(windowId, tabId, url);
      container.appendChild(iframeContainer);

      tab.click(); // Activate tab
    }

    function extractTitle(input) {
      try {
        return new URL(input.startsWith('http') ? input : 'https://' + input).hostname;
      } catch {
        return input.length > 20 ? input.slice(0, 20) + '...' : input;
      }
    }

    openWindowsButton.addEventListener('click', () => {
      if (!openWindowsButton.disabled) {
        openMultipleWindows();
      }
    });

    darkModeToggle.addEventListener('click', () => {
      const isDark = document.documentElement.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      darkModeToggle.textContent = isDark ? 'Light Mode' : 'Dark Mode';
    });
  </script>
</body>

</html>
